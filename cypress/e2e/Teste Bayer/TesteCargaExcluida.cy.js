import { faker } from "@faker-js/faker/locale/pt_BR";
import { cnpj } from "cpf-cnpj-validator";

Cypress.on("uncaught:exception", () => false); // Ignora erros JS da aplicação

const {
  validarCampoSemMascara,
  validarCampoSemCase,
  validarTextoVisivel,
} = require("../../pages/tratamentos/validacoesCampos.js");

const cnpjsExcluidos = [
  "53628393000220",
  "31925548000176",
  "03533726000188",
  "03533726000420",
  "03533726000773",
  "03533726000935",
  "03533726001400",
  "03533726001583",
  "03533726001664",
  "10257164000152",
  "00867860000127",
  "01845406000138",
  "02541094000131",
  "02560878000107",
  "02567954000106",
  "03976567000196",
  "04879244000147",
  "04896159000197",
  "04914383000164",
  "05539852000175",
  "06103860000137",
  "09567325000125",
  "14469152000142",
  "15194004000125",
  "15200249000380",
  "19125639000121",
  "21299615000211",
  "27466060000150",
  "30633028000127",
  "35650324000150",
  "35676579000191",
  "53329314000107",
  "59054098000102",
  "60975737000909",
  "60975737003509",
  "92815000000168",
  "00100845000159",
  "02615468000116",
  "02972680000130",
  "03704010000104",
  "06141371000170",
  "07087550000139",
  "07088017000191",
  "08088802000107",
  "08092615000105",
  "10617086000150",
  "11708311000126",
  "14606321000149",
  "14712350000195",
  "21575709000195",
  "22520710000185",
  "27589996000179",
  "28683712000171",
  "35801692000151",
  "45615309000124",
  "53756185000125",
  "59484469000196",
  "67181545000112",
  "86503935000106",
  "02094673000183",
  "02100801000154",
  "02667487000196",
  "03016023000182",
  "04049792000140",
  "04536506000170",
  "05652543000107",
  "06184891000160",
  "07136971000102",
  "07667809000110",
  "08145378000195",
  "09157248000135",
  "13761374000171",
  "14736706000120",
  "00017014793896",
  "17874426000177",
  "17896137000179",
  "19272571000103",
  "21684278000103",
  "22647875000112",
  "23884551000160",
  "26947257000149",
  "27657893000107",
  "27699266000120",
  "30910701000129",
  "32137805000178",
  "34434191000111",
  "35819524000193",
  "37232310000141",
  "60992427000650",
  "61389797000155",
  "68971910000155",
  "86909454000103",
  "86968260000170",
  "00645422000114",
  "02734641000286",
  "03490958000104",
  "03756158000184",
  "03757266000171",
  "04101394000125",
  "04111895000192",
  "04159778000107",
  "04640213000139",
  "06256565000200",
  "07263658000135",
  "07750144000104",
  "08234103000128",
  "10733538000169",
  "14797815000158",
  "14816606000104",
  "15648728000100",
  "19425430000183",
  "21747166000146",
  "21803314000100",
  "23953466000107",
  "24962095000192",
  "24977336000177",
  "24981941000111",
  "29907784000118",
  "29910807000143",
  "32185605000190",
  "33641176000181",
  "34698196000151",
  "60255536000180",
  "01070380000101",
  "03794239000179",
  "04689963000103",
  "06333029000171",
  "07265515000162",
  "07265515000596",
  "07265515000758",
  "07272404000183",
  "08844030000196",
  "08846255000181",
  "09252815000132",
  "10820720000157",
  "12955953000192",
  "13018691000100",
  "13912419000161",
  "13986611000100",
  "14920631000133",
  "15798225000102",
  "16205262000122",
  "18287887000106",
  "20773570000121",
  "24063544000160",
  "25016319000136",
  "31160674000187",
  "34790104000169",
  "34865026000114",
  "37575038000100",
  "43586122000971",
  "47074851000819",
  "55989784000114",
  "60678604000113",
  "61599908000158",
  "00698149000196",
  "01615319000194",
  "02789128000101",
  "03221438000198",
  "03795053000134",
  "04275687000129",
  "04711695000170",
  "05893903000162",
  "07358679000134",
  "07832444000132",
  "08366634000174",
  "08883265000197",
  "08913689000157",
  "10871534000147",
  "13047482000187",
  "14074546000100",
  "14137673000100",
  "15014665000121",
  "18457427000189",
  "21946256000166",
  "21958357000157",
  "23010581000148",
  "26393262000157",
  "28215068000107",
  "32513459000185",
  "33760690000136",
  "33794132000191",
  "33850716000137",
  "36447977000107",
  "40480865000117",
  "40480998000193",
  "60742616002022",
  "60765823000130",
  "71582977000102",
  "71724967000164",
  "81306136000126",
  "84694405000167",
  "00395788000182",
  "02818749000176",
  "05346842000113",
  "06040343000166",
  "07852876000105",
  "08428765000139",
  "10892164000124",
  "15128652000183",
  "18675846000197",
  "19807438000104",
  "21067383000195",
  "22159948000127",
  "23278898000160",
  "26470585000105",
  "27232471000181",
  "29251097000197",
  "30131145000192",
  "32745665000110",
  "33917568000120",
  "52802691000140",
  "57553265000134",
  "57571275000607",
  "57722118000140",
  "60922168000429",
  "72127210000156",
  "77819282000188",
  "04313392000108",
  "06958432000196",
  "06974955000126",
  "07894422000105",
  "07912794000109",
  "10950856000181",
  "11457028000179",
  "11470358000102",
  "12307187000583",
  "13252226000121",
  "14351770000193",
  "21177373000102",
  "21284406000113",
  "22217925000121",
  "23343049000142",
  "25415993000193",
  "26628519000102",
  "27462172000133",
  "30412068000149",
  "30441295000100",
  "31540527000132",
  "33029249000189",
  "34153585000100",
  "44782779000110",
  "60922168001077",
  "60922168001905",
  "60922168002553",
  "60922168004335",
  "60922168005226",
  "72957814000120",
  "88625686002443",
  "88625686003849",
  "92672559000186",
  "92685833000151",
  "92741016000254",
];

const nomeEmpresa = faker.company.name();
const CNPJValido = cnpj.generate();

describe("Politica Comercial - Validação de CNPJs excluídos", () => {
  beforeEach(() => {
    cy.visit(
      "https://homologacaoesp.interplayers.com.br/PRJ/Especialidades/Acesso.aspx"
    );

    cy.get("#ContentPlaceHolder1_Control_Login2_Login1_UserName").type(
      "admbayer@dnaspecialty.com.br"
    );
    cy.get("#ContentPlaceHolder1_Control_Login2_Login1_Password").type(
      "12345678"
    );
    cy.get("#ContentPlaceHolder1_Control_Login2_Login1_LoginButton").click();
  });

  function acessarPoliticaComercial() {
    cy.visit(
      "https://homologacaoesp.interplayers.com.br/PRJ/Especialidades/PoliticaCondicaoHTML/PoliticaComercial_Lista.aspx?cod=FAC586E9-5845-4798-92DC-99D238B66E6F|2179"
    );

    cy.get("#ContentPlaceHolder1_txtPoliticaComercial")
      .invoke(
        "val",
        "MA_SF_POLITICA COMERCIAL MARKET ACCESS INDIRETO 2025 2026 - JULHO"
      )
      .trigger("change");

    cy.get("#ContentPlaceHolder1_btnPesquisar").click();
    cy.get("#ContentPlaceHolder1_rptPolitica_imgSelecionar_0").click();
  }

  function validarCNPJsExcluidos() {
    cy.get("#abaCliente-trigger").click();

    cnpjsExcluidos.forEach((cnpj) => {
      cy.get("#ContentPlaceHolder1_txtProcurarNoFiltro").clear().type(cnpj);
      cy.get("#ContentPlaceHolder1_btnProcurarNoFiltro").click();

      cy.get("#ajaxLoading", { timeout: 10000 }).should("not.be.visible");

      cy.get("body").then(($body) => {
        if ($body.text().includes(cnpj)) {
          throw new Error(`❌ CNPJ ainda visível na interface: ${cnpj}`);
        } else {
          cy.log(`✅ CNPJ ausente conforme esperado: ${cnpj}`);
        }
      });
    });
  }

  it("Valida que os CNPJs removidos não estão mais visíveis na política", () => {
    acessarPoliticaComercial();
    validarCNPJsExcluidos();
  });
});
